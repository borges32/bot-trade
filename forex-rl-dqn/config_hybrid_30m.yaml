# Configuração Híbrida: LightGBM + PPO para Trading Forex - TIMEFRAME 30 MINUTOS
# =================================================================================
# Períodos de indicadores otimizados para timeframe de 30 minutos
# Em 30m, 1 dia = 48 candles, 1 semana = 336 candles

# Configurações Gerais
general:
  seed: 42
  verbose: true
  log_dir: "logs/hybrid_30m"
  models_dir: "models/hybrid_30m"
  timeframe: "30m"
  
# Dados
data:
  train_file: "data/usdjpy_history_30m.csv"  # Arquivo de treino 30m
  val_split: 0.15  # 15% para validação
  test_split: 0.15  # 15% para teste
  
  # Colunas OBRIGATÓRIAS no CSV (OHLCV)
  timestamp_col: "timestamp"
  open_col: "open"
  high_col: "high"
  low_col: "low"
  close_col: "close"
  volume_col: "volume"
  
  # Janela de lookback para features
  # 30m: 48 candles = 1 dia de trading
  lookback_window: 72  # 1.5 dias
  
# Features Técnicas - OTIMIZADO PARA 30 MINUTOS
features:
  # === INDICADORES PRINCIPAIS (sempre calculados do zero) ===
  
  # RSI - Período padrão ajustado
  use_rsi: true
  rsi_period: 14  # 30m: 14 períodos = 7 horas
  
  # EMAs - Períodos clássicos ajustados para 30m
  use_ema: true
  ema_periods: [12, 26, 50]  # 12=6h, 26=13h, 50=25h
  ema_fast: 12  # Rápida: 6 horas
  ema_slow: 26  # Lenta: 13 horas
  
  # MACD - Configuração clássica
  use_macd: true
  macd_fast: 12  # 6 horas
  macd_slow: 26  # 13 horas
  macd_signal: 9  # 4.5 horas
  
  # Bollinger Bands - Período padrão
  use_bollinger: true
  bb_period: 20  # 10 horas
  bb_std: 2.0
  
  # ATR - Volatilidade padrão
  use_atr: true
  atr_period: 14  # 7 horas
  
  # Momentum - Períodos médios
  use_momentum: true
  momentum_periods: [10, 20]  # 10=5h, 20=10h
  
  # SMAs - Períodos padrão
  use_sma: true
  sma_periods: [20, 50]  # 20=10h, 50=25h
  
  # Stochastic - Padrão
  use_stochastic: true
  stoch_k: 14  # 7 horas
  stoch_d: 3
  
  # ADX - Força de tendência
  use_adx: true
  adx_period: 14  # 7 horas
  
  # Volatilidade - Janela média
  use_volatility: true
  volatility_window: 20  # 10 horas
  
  # Volume - Médias móveis
  use_volume_features: true
  volume_ma_period: 20  # 10 horas
  
  # Retornos multi-período
  use_returns: true
  return_periods: [1, 3, 6, 12, 24]  # 30m, 1.5h, 3h, 6h, 12h

# LightGBM - Modelo Supervisionado
lightgbm:
  model_type: "classifier"
  
  # Target: prever N candles à frente (otimizado via diagnóstico)
  prediction_horizon: 20  # 20 candles = 10 horas à frente (30m)
  classification_threshold: 0.0001  # 0.01% movimento mínimo (balanceado em 50.9%)
  
  params:
    objective: "binary"
    metric: "auc"
    boosting_type: "gbdt"
    num_leaves: 31
    max_depth: 6
    learning_rate: 0.05
    n_estimators: 500
    min_child_samples: 20
    subsample: 0.8
    subsample_freq: 1
    colsample_bytree: 0.8
    reg_alpha: 0.1
    reg_lambda: 0.1
    class_weight: "balanced"  # Balanceia classes automaticamente
    random_state: 42
    n_jobs: -1
    verbose: -1
  
  # Feature selection
  min_correlation_threshold: 0.01  # Remove features com corr < 0.01
    
  early_stopping_rounds: 50
  save_feature_importance: true

# PPO - Reinforcement Learning
ppo:
  env:
    initial_balance: 10000.0
    leverage: 1.0
    commission: 0.0001  # Spread típico para 30m
    slippage: 0.00005
    
    # Gestão de risco - Ajustado para 30m
    max_position_size: 1.0
    stop_loss_pct: 0.02  # 2% (30m: movimentos maiores que 15m)
    take_profit_pct: 0.04  # 4% (ratio 2:1)
    max_drawdown_pct: 0.25  # 25% drawdown máximo
    
    # Recompensa
    reward_scaling: 1.0
    risk_penalty_lambda: 0.05  # Penalidade menor (permite mais risco)
    
  params:
    learning_rate: 0.001  # Taxa de aprendizado padrão
    n_steps: 2048
    batch_size: 64
    n_epochs: 10
    gamma: 0.99  # Desconto padrão (30m: horizonte mais longo)
    gae_lambda: 0.95
    clip_range: 0.2
    clip_range_vf: null
    ent_coef: 0.03  # Exploração moderada-alta
    vf_coef: 0.5
    max_grad_norm: 0.5
    
  policy_network:
    net_arch:
      - 256
      - 256
      - 128
    activation: "tanh"
  
  training:
    total_timesteps: 500000  # ~10400 candles de 30m
    eval_freq: 10000
    n_eval_episodes: 10
    save_freq: 50000
    
  device: "auto"

# Inferência
inference:
  lightgbm_model_path: "models/hybrid_30m/lightgbm_model.txt"
  ppo_model_path: "models/hybrid_30m/ppo_model.zip"
  min_confidence: 0.60  # Confiança padrão para 30m
  
# API
api:
  host: "0.0.0.0"
  port: 8000  # Porta padrão
  title: "Forex Trading Signal API - 30m - LightGBM + PPO"
  description: "API para sinais de trading 30 minutos baseados em LightGBM + PPO"
  version: "1.0.0"
