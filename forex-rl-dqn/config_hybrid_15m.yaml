# Configuração LightGBM para Trading Forex - TIMEFRAME 15 MINUTOS
# =================================================================
# Períodos de indicadores otimizados para timeframe de 15 minutos
# Em 15m, 1 dia = 96 candles, 1 semana = 672 candles

# Configurações Gerais
general:
  seed: 55
  verbose: true
  log_dir: "logs/hybrid_15m"
  models_dir: "models/hybrid_15m"
  timeframe: "15m"
  
# Dados
data:
  train_file: "data/usdjpy_history_15m.csv"  # Arquivo de treino 15m
  val_split: 0.15  # 15% para validação
  test_split: 0.15  # 15% para teste
  
  # Colunas OBRIGATÓRIAS no CSV (OHLCV)
  timestamp_col: "timestamp"
  open_col: "open"
  high_col: "high"
  low_col: "low"
  close_col: "close"
  volume_col: "volume"
  
  # Janela de lookback para features
  # 15m: 96 candles = 1 dia de trading
  #lookback_window: 96
  lookback_window: 96
  
# Features Técnicas - OTIMIZADO PARA 15 MINUTOS
features:
  # === INDICADORES PRINCIPAIS (sempre calculados do zero) ===
  
  # RSI - Timeframe curto requer período menor
  use_rsi: false
  rsi_period: 10  # 15m: 10 períodos = 2.5 horas
  
  # EMAs - Períodos ajustados para 15m
  use_ema: true
  ema_periods: [8, 21, 50]  # 8=2h, 21=5.25h, 50=12.5h
  ema_fast: 8   # Rápida: 2 horas
  ema_slow: 21  # Lenta: ~5 horas
  
  # MACD - Ajustado para 15m
  use_macd: true
  macd_fast: 8   # 2 horas
  macd_slow: 17  # ~4 horas
  macd_signal: 6 # 1.5 horas
  
  # Bollinger Bands - Período menor para 15m
  use_bollinger: true
  bb_period: 16  # 4 horas
  bb_std: 2.0
  
  # ATR - Volatilidade de curto prazo
  use_atr: false
  atr_period: 10  # 2.5 horas
  
  # Momentum - Períodos curtos
  use_momentum: false
  momentum_periods: [6, 12]  # 6=1.5h, 12=3h
  
  # SMAs - Períodos ajustados
  use_sma: false
  sma_periods: [16, 32]  # 16=4h, 32=8h
  
  # Stochastic - Mais sensível
  use_stochastic: false
  stoch_k: 10  # 2.5 horas
  stoch_d: 3
  
  # ADX - Força de tendência
  use_adx: false
  adx_period: 10  # 2.5 horas
  
  # Volatilidade - Janela curta
  use_volatility: false
  volatility_window: 16  # 4 horas
  
  # Volume - Médias móveis
  use_volume_features: false
  volume_ma_period: 16  # 4 horas
  
  # Retornos multi-período
  use_returns: false
  return_periods: [1, 2, 4, 8, 16]  # 15m, 30m, 1h, 2h, 4h

# LightGBM - Modelo Supervisionado
lightgbm:
  model_type: "regressor"  # MUDOU: regressor em vez de classifier
  
  # Target: prever retorno percentual N candles à frente
  prediction_horizon: 3  # 3 candles = 45 minutos à frente (15m)
  
  params:
    # === PARÂMETROS PRINCIPAIS ===
    objective: "regression"  # Tipo de tarefa: regression (prever valor contínuo) ou binary (classificação)
    metric: "rmse"  # Métrica de avaliação: RMSE (Root Mean Squared Error) para regressão
    boosting_type: "gbdt"  # Tipo de boosting: gbdt (Gradient Boosting Decision Tree) - padrão e mais preciso
    
    # === ESTRUTURA DAS ÁRVORES ===
    num_leaves: 50  # Número máximo de folhas por árvore - controla complexidade (padrão: 31)
    max_depth: 6  # Profundidade máxima das árvores - previne overfitting (padrão: -1 = sem limite)
    
    # === APRENDIZADO ===
    learning_rate: 0.02  # Taxa de aprendizado - menor = mais conservador mas pode precisar mais árvores (padrão: 0.1)
    n_estimators: 800  # Número de árvores (boosting rounds) - mais árvores = mais preciso mas mais lento
    
    # === REGULARIZAÇÃO (PREVINE OVERFITTING) ===
    min_child_samples: 20  # Mínimo de amostras por folha - aumentar previne overfitting (padrão: 20)
    subsample: 0.8  # Fração de amostras usadas por árvore (0.8 = 80%) - reduz overfitting (padrão: 1.0)
    subsample_freq: 1  # Frequência de subsampling - 1 = a cada iteração (padrão: 0)
    colsample_bytree: 0.8  # Fração de features por árvore (0.8 = 80%) - reduz overfitting (padrão: 1.0)
    reg_alpha: 0.3  # Regularização L1 (Lasso) - penaliza features pouco importantes (padrão: 0.0)
    reg_lambda: 0.3  # Regularização L2 (Ridge) - suaviza pesos dos modelos (padrão: 0.0)
    
    # === REPRODUTIBILIDADE E PERFORMANCE ===
    random_state: 42  # Seed para reprodutibilidade - SERÁ SOBRESCRITO por general.seed
    n_jobs: -1  # Número de threads paralelas - (-1 = usar todos os cores disponíveis)
    verbose: -1  # Nível de log do LightGBM - SERÁ SOBRESCRITO por general.verbose (1=normal, -1=silencioso)
    
  # === CONTROLE DE TREINAMENTO ===
  early_stopping_rounds: 50  # Para treinamento se métrica não melhorar por N rounds - economiza tempo
  save_feature_importance: true  # Salva importância das features em CSV - útil para análise

# Inferência
inference:
  lightgbm_model_path: "models/hybrid_15m/lightgbm_model.txt"
  min_confidence: 0.03  # 3% - threshold para 15m (timeframe mais curto)
  
# API
api:
  host: "0.0.0.0"
  port: 8001
  title: "Forex Trading Signal API - 15m - LightGBM"
  description: "API para sinais de trading 15 minutos baseados em LightGBM"
  version: "1.0.0"
