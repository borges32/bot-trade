# Configuração Híbrida: LightGBM + PPO para Trading Forex - TIMEFRAME 15 MINUTOS
# =================================================================================
# Períodos de indicadores otimizados para timeframe de 15 minutos
# Em 15m, 1 dia = 96 candles, 1 semana = 672 candles

# Configurações Gerais
general:
  seed: 42
  verbose: true
  log_dir: "logs/hybrid_15m"
  models_dir: "models/hybrid_15m"
  timeframe: "15m"
  
# Dados
data:
  train_file: "data/usdjpy_history_15m.csv"  # Arquivo de treino 15m
  val_split: 0.15  # 15% para validação
  test_split: 0.15  # 15% para teste
  
  # Colunas OBRIGATÓRIAS no CSV (OHLCV)
  timestamp_col: "timestamp"
  open_col: "open"
  high_col: "high"
  low_col: "low"
  close_col: "close"
  volume_col: "volume"
  
  # Janela de lookback para features
  # 15m: 96 candles = 1 dia de trading
  lookback_window: 96
  
# Features Técnicas - OTIMIZADO PARA 15 MINUTOS
features:
  # === INDICADORES PRINCIPAIS (sempre calculados do zero) ===
  
  # RSI - Timeframe curto requer período menor
  use_rsi: true
  rsi_period: 10  # 15m: 10 períodos = 2.5 horas
  
  # EMAs - Períodos ajustados para 15m
  use_ema: true
  ema_periods: [8, 21, 50]  # 8=2h, 21=5.25h, 50=12.5h
  ema_fast: 8   # Rápida: 2 horas
  ema_slow: 21  # Lenta: ~5 horas
  
  # MACD - Ajustado para 15m
  use_macd: true
  macd_fast: 8   # 2 horas
  macd_slow: 17  # ~4 horas
  macd_signal: 6 # 1.5 horas
  
  # Bollinger Bands - Período menor para 15m
  use_bollinger: true
  bb_period: 16  # 4 horas
  bb_std: 2.0
  
  # ATR - Volatilidade de curto prazo
  use_atr: true
  atr_period: 10  # 2.5 horas
  
  # Momentum - Períodos curtos
  use_momentum: true
  momentum_periods: [6, 12]  # 6=1.5h, 12=3h
  
  # SMAs - Períodos ajustados
  use_sma: true
  sma_periods: [16, 32]  # 16=4h, 32=8h
  
  # Stochastic - Mais sensível
  use_stochastic: true
  stoch_k: 10  # 2.5 horas
  stoch_d: 3
  
  # ADX - Força de tendência
  use_adx: true
  adx_period: 10  # 2.5 horas
  
  # Volatilidade - Janela curta
  use_volatility: true
  volatility_window: 16  # 4 horas
  
  # Volume - Médias móveis
  use_volume_features: true
  volume_ma_period: 16  # 4 horas
  
  # Retornos multi-período
  use_returns: true
  return_periods: [1, 2, 4, 8, 16]  # 15m, 30m, 1h, 2h, 4h

# LightGBM - Modelo Supervisionado
lightgbm:
  model_type: "classifier"
  
  # Target: prever N candles à frente
  prediction_horizon: 4  # 4 candles = 1 hora à frente
  classification_threshold: 0.0001  # 0.01% movimento mínimo
  
  params:
    objective: "binary"
    metric: "auc"
    boosting_type: "gbdt"
    num_leaves: 31
    max_depth: 6
    learning_rate: 0.05
    n_estimators: 500
    min_child_samples: 20
    subsample: 0.8
    subsample_freq: 1
    colsample_bytree: 0.8
    reg_alpha: 0.1
    reg_lambda: 0.1
    random_state: 42
    n_jobs: -1
    verbose: -1
    
  early_stopping_rounds: 50
  save_feature_importance: true

# PPO - Reinforcement Learning
ppo:
  env:
    initial_balance: 10000.0
    leverage: 1.0
    commission: 0.0001  # Spread típico para 15m
    slippage: 0.00005
    
    # Gestão de risco - Ajustado para 15m
    max_position_size: 1.0
    stop_loss_pct: 0.015  # 1.5% (15m: movimentos menores)
    take_profit_pct: 0.03  # 3% (ratio 2:1)
    max_drawdown_pct: 0.20  # 20% drawdown máximo
    
    # Recompensa
    reward_scaling: 1.0
    risk_penalty_lambda: 0.08  # Penalidade moderada
    
  params:
    learning_rate: 0.0008  # Ajustado para 15m
    n_steps: 2048
    batch_size: 64
    n_epochs: 10
    gamma: 0.98  # Desconto menor (15m: futuro mais próximo)
    gae_lambda: 0.95
    clip_range: 0.2
    clip_range_vf: null
    ent_coef: 0.025  # Exploração moderada
    vf_coef: 0.5
    max_grad_norm: 0.5
    
  policy_network:
    net_arch:
      - 256
      - 256
      - 128
    activation: "tanh"
  
  training:
    total_timesteps: 500000  # ~5200 candles de 15m
    eval_freq: 10000
    n_eval_episodes: 10
    save_freq: 50000
    
  device: "auto"

# Inferência
inference:
  lightgbm_model_path: "models/hybrid_15m/lightgbm_model.txt"
  ppo_model_path: "models/hybrid_15m/ppo_model.zip"
  min_confidence: 0.58  # Confiança menor para 15m (mais sinais)
  
# API
api:
  host: "0.0.0.0"
  port: 8001  # Porta diferente de 30m
  title: "Forex Trading Signal API - 15m - LightGBM + PPO"
  description: "API para sinais de trading 15 minutos baseados em LightGBM + PPO"
  version: "1.0.0"
