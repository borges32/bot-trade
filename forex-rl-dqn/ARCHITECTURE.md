# ðŸ—ï¸ Arquitetura do Sistema - Diagrama Detalhado

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DADOS HISTÃ“RICOS (CSV)                              â”‚
â”‚                     Forex OHLCV do cTrader / MT5                             â”‚
â”‚              timestamp, open, high, low, close, volume                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       FEATURE ENGINEERING                                    â”‚
â”‚                    (src/common/features.py)                                  â”‚
â”‚                                                                              â”‚
â”‚  â€¢ Indicadores TÃ©cnicos:                                                    â”‚
â”‚    - SMA (10, 20, 50)                                                       â”‚
â”‚    - EMA (9, 21, 55)                                                        â”‚
â”‚    - RSI (14)                                                               â”‚
â”‚    - MACD (12, 26, 9)                                                       â”‚
â”‚    - Bollinger Bands (20, 2)                                                â”‚
â”‚    - ATR (14)                                                               â”‚
â”‚    - Stochastic (14, 3)                                                     â”‚
â”‚    - ADX (14)                                                               â”‚
â”‚                                                                              â”‚
â”‚  â€¢ Features de PreÃ§o:                                                       â”‚
â”‚    - Retornos (1, 5, 10 perÃ­odos)                                          â”‚
â”‚    - Volatilidade (janela 20)                                               â”‚
â”‚    - Features de volume                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                                â”‚
                     â”‚                                â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                           â”‚    â”‚                             â”‚
      â”‚    MODELO LIGHTGBM        â”‚    â”‚    AMBIENTE GYM (PPO)       â”‚
      â”‚ (src/models/lightgbm_...)  â”‚    â”‚  (src/envs/forex_trading...) â”‚
      â”‚                           â”‚    â”‚                             â”‚
      â”‚ Tipo: Classifier/Regressorâ”‚    â”‚  Estado (Observation):      â”‚
      â”‚                           â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
      â”‚ Treino:                   â”‚    â”‚  â”‚ 1. Sinal LightGBM    â”‚   â”‚
      â”‚ â€¢ Train/Val/Test split    â”‚â”€â”€â”€â”€â”¼â”€â”€â”‚ 2. Features tÃ©cnicas â”‚   â”‚
      â”‚ â€¢ Early stopping          â”‚    â”‚  â”‚ 3. PosiÃ§Ã£o atual     â”‚   â”‚
      â”‚ â€¢ Feature importance      â”‚    â”‚  â”‚ 4. PnL nÃ£o realizado â”‚   â”‚
      â”‚                           â”‚    â”‚  â”‚ 5. Equity            â”‚   â”‚
      â”‚ Output:                   â”‚    â”‚  â”‚ 6. Drawdown          â”‚   â”‚
      â”‚ â€¢ p_up (probabilidade)    â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
      â”‚   OU                      â”‚    â”‚                             â”‚
      â”‚ â€¢ retorno_esperado        â”‚    â”‚  AÃ§Ãµes (Discretas):         â”‚
      â”‚                           â”‚    â”‚  â€¢ 0 = Neutro/Flat          â”‚
      â”‚ MÃ©tricas:                 â”‚    â”‚  â€¢ 1 = Comprar (Long)       â”‚
      â”‚ â€¢ AUC / Accuracy          â”‚    â”‚  â€¢ 2 = Vender (Short)       â”‚
      â”‚ â€¢ Direction Accuracy      â”‚    â”‚                             â”‚
      â”‚                           â”‚    â”‚  Recompensa:                â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  r = Î”PnL - custos          â”‚
                                       â”‚      - Î»*drawdown           â”‚
                                       â”‚                             â”‚
                                       â”‚  Recursos:                  â”‚
                                       â”‚  â€¢ Stop Loss / Take Profit  â”‚
                                       â”‚  â€¢ Commission + Slippage    â”‚
                                       â”‚  â€¢ Drawdown tracking        â”‚
                                       â”‚  â€¢ GestÃ£o de capital        â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â–¼
                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                       â”‚     AGENTE PPO              â”‚
                                       â”‚  (src/models/ppo_agent.py)  â”‚
                                       â”‚                             â”‚
                                       â”‚  Arquitetura:               â”‚
                                       â”‚  â€¢ Policy Network:          â”‚
                                       â”‚    [256, 256, 128]          â”‚
                                       â”‚  â€¢ Value Network:           â”‚
                                       â”‚    [256, 256, 128]          â”‚
                                       â”‚                             â”‚
                                       â”‚  Algoritmo: PPO             â”‚
                                       â”‚  â€¢ Clip Range: 0.2          â”‚
                                       â”‚  â€¢ GAE Lambda: 0.95         â”‚
                                       â”‚  â€¢ Gamma: 0.99              â”‚
                                       â”‚  â€¢ Learning Rate: 3e-4      â”‚
                                       â”‚                             â”‚
                                       â”‚  Treino:                    â”‚
                                       â”‚  â€¢ Total timesteps: 500k    â”‚
                                       â”‚  â€¢ Eval freq: 10k           â”‚
                                       â”‚  â€¢ Checkpoints salvos       â”‚
                                       â”‚                             â”‚
                                       â”‚  Output:                    â”‚
                                       â”‚  â€¢ PolÃ­tica otimizada       â”‚
                                       â”‚  â€¢ Ï€(a|s) â†’ aÃ§Ã£o            â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚                               â”‚                   â”‚
                      â–¼                               â–¼                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ MODELOS TREINADOS   â”‚        â”‚  SISTEMA INFERÃŠNCIA â”‚  â”‚  SCRIPTS      â”‚
          â”‚                     â”‚        â”‚                     â”‚  â”‚  AUXILIARES   â”‚
          â”‚ models/hybrid/      â”‚        â”‚ (src/inference/)    â”‚  â”‚               â”‚
          â”‚                     â”‚        â”‚                     â”‚  â”‚ â€¢ test_*.py   â”‚
          â”‚ â€¢ lightgbm_model... â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”‚  TradingPredictor:  â”‚  â”‚ â€¢ example_*.pyâ”‚
          â”‚   - .txt (booster)  â”‚        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚ â€¢ train_*.sh  â”‚
          â”‚   - .metadata.pkl   â”‚        â”‚  â”‚ 1. Load modelsâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚   - .importance.csv â”‚        â”‚  â”‚ 2. Prep data  â”‚  â”‚
          â”‚                     â”‚        â”‚  â”‚ 3. LightGBM   â”‚  â”‚
          â”‚ â€¢ ppo_model.zip     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚    predict    â”‚  â”‚
          â”‚   (sb3 format)      â”‚        â”‚  â”‚ 4. Build obs  â”‚  â”‚
          â”‚                     â”‚        â”‚  â”‚ 5. PPO action â”‚  â”‚
          â”‚ â€¢ checkpoints/      â”‚        â”‚  â”‚ 6. Return     â”‚  â”‚
          â”‚ â€¢ metrics.yaml      â”‚        â”‚  â”‚    decision   â”‚  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                         â”‚                     â”‚
                                         â”‚  Recursos:          â”‚
                                         â”‚  â€¢ Estado tracking  â”‚
                                         â”‚  â€¢ PnL calculation  â”‚
                                         â”‚  â€¢ Confidence score â”‚
                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â–¼
                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                         â”‚   API FASTAPI        â”‚
                                         â”‚ (src/inference/      â”‚
                                         â”‚  service.py)         â”‚
                                         â”‚                      â”‚
                                         â”‚  Endpoints:          â”‚
                                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                                         â”‚  â”‚ GET /          â”‚  â”‚
                                         â”‚  â”‚ GET /health    â”‚  â”‚
                                         â”‚  â”‚ POST /signal   â”‚â—„â”€â”¼â”€â”
                                         â”‚  â”‚ POST /execute  â”‚  â”‚ â”‚
                                         â”‚  â”‚ GET /state     â”‚  â”‚ â”‚
                                         â”‚  â”‚ POST /reset    â”‚  â”‚ â”‚
                                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
                                         â”‚                      â”‚ â”‚
                                         â”‚  Features:           â”‚ â”‚
                                         â”‚  â€¢ Pydantic models   â”‚ â”‚
                                         â”‚  â€¢ Auto docs (Swagger)â”‚ â”‚
                                         â”‚  â€¢ Validation        â”‚ â”‚
                                         â”‚  â€¢ Error handling    â”‚ â”‚
                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                                    â”‚             â”‚
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                                        â”‚   HTTP/JSON        â”‚    â”‚
                                        â”‚   Port: 8000       â”‚    â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                                                    â”‚             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                                   â”‚
                â–¼                                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CLIENTE PYTHON    â”‚              â”‚  INTEGRAÃ‡ÃƒO       â”‚
    â”‚  (api_client_...)   â”‚              â”‚  COM BROKER       â”‚
    â”‚                    â”‚              â”‚                   â”‚
    â”‚  TradingAPIClient: â”‚              â”‚  â€¢ cTrader API    â”‚
    â”‚  â€¢ get_signal()    â”‚              â”‚  â€¢ MT5 API        â”‚
    â”‚  â€¢ execute_action()â”‚              â”‚  â€¢ Outros         â”‚
    â”‚  â€¢ get_state()     â”‚              â”‚                   â”‚
    â”‚  â€¢ reset_state()   â”‚              â”‚  Loop:            â”‚
    â”‚                    â”‚              â”‚  1. Get candles   â”‚
    â”‚  Exemplos:         â”‚              â”‚  2. Get signal    â”‚
    â”‚  â€¢ Single predict  â”‚              â”‚  3. Check conf    â”‚
    â”‚  â€¢ Trading loop    â”‚              â”‚  4. Execute trade â”‚
    â”‚  â€¢ Integration     â”‚              â”‚  5. Monitor       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            FLUXO DE DADOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. TREINAMENTO:
   CSV â†’ Features â†’ [LightGBM Train] â†’ lightgbm_model.txt
                 â†’ [PPO Train] â†’ ppo_model.zip

2. INFERÃŠNCIA:
   Candles â†’ Features â†’ LightGBM.predict() â†’ signal
                     â†’ Build observation â†’ PPO.predict() â†’ action
                     â†’ Combine â†’ Decision (comprar/vender/neutro)

3. PRODUÃ‡ÃƒO:
   Broker â†’ Candles â†’ API /signal â†’ Decision â†’ API /execute â†’ Broker


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         CONFIGURAÃ‡ÃƒO CENTRALIZADA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                        config_hybrid.yaml
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ â€¢ Data paths    â”‚
                        â”‚ â€¢ Features cfg  â”‚
                        â”‚ â€¢ LightGBM cfg  â”‚
                        â”‚ â€¢ PPO cfg       â”‚
                        â”‚ â€¢ Env cfg       â”‚
                        â”‚ â€¢ API cfg       â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          Usado por TODOS
                          os mÃ³dulos


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              TECNOLOGIAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Componente      â”‚ Tecnologia                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dados           â”‚ Pandas, NumPy                                          â”‚
â”‚ Features        â”‚ Pandas, TA-Lib patterns                                â”‚
â”‚ LightGBM        â”‚ LightGBM, scikit-learn                                 â”‚
â”‚ RL              â”‚ Stable-Baselines3, PyTorch                             â”‚
â”‚ Ambiente        â”‚ Gymnasium (OpenAI Gym)                                 â”‚
â”‚ API             â”‚ FastAPI, Pydantic, Uvicorn                             â”‚
â”‚ Logging         â”‚ TensorBoard, Python logging                            â”‚
â”‚ Config          â”‚ PyYAML                                                 â”‚
â”‚ SerializaÃ§Ã£o    â”‚ Joblib, LightGBM native                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ“Š Fluxo de DecisÃ£o Detalhado

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PROCESSO DE DECISÃƒO                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Recebe 100 candles recentes
   â”œâ”€ Valida dados (>= 50 candles)
   â””â”€ Ordena por timestamp

2. Feature Engineering
   â”œâ”€ Calcula indicadores tÃ©cnicos
   â”œâ”€ Normaliza valores
   â””â”€ Remove NaN

3. LightGBM Prediction
   â”œâ”€ Extrai features do Ãºltimo candle
   â”œâ”€ Prediz: p_up ou retorno_esperado
   â””â”€ Calcula confianÃ§a baseada na prediÃ§Ã£o

4. ConstrÃ³i Estado para PPO
   â”œâ”€ Sinal LightGBM (1 valor)
   â”œâ”€ Features tÃ©cnicas normalizadas (N valores)
   â””â”€ Estado da conta (5 valores):
       â€¢ PosiÃ§Ã£o atual (-1, 0, 1)
       â€¢ PnL nÃ£o realizado normalizado
       â€¢ Equity normalizado
       â€¢ Drawdown atual
       â€¢ Retorno total

5. PPO Decision
   â”œâ”€ Passa estado pela rede neural
   â”œâ”€ PolÃ­tica Ï€(a|s) retorna distribuiÃ§Ã£o
   â””â”€ Seleciona aÃ§Ã£o: 0, 1, ou 2

6. Post-Processing
   â”œâ”€ Mapeia aÃ§Ã£o para nome ("comprar", "vender", "neutro")
   â”œâ”€ Calcula confianÃ§a final
   â””â”€ Prepara resposta

7. DecisÃ£o Final
   â”œâ”€ Se confianÃ§a > threshold:
   â”‚   â””â”€ EXECUTAR aÃ§Ã£o
   â””â”€ Se confianÃ§a <= threshold:
       â””â”€ AGUARDAR (nÃ£o operar)
```

## ðŸŽ¯ MÃ©tricas de Qualidade em Cada Etapa

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Etapa        â”‚ MÃ©tricas de Qualidade                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Features     â”‚ â€¢ % de NaN (deve ser <5%)                        â”‚
â”‚              â”‚ â€¢ CorrelaÃ§Ã£o com target                          â”‚
â”‚              â”‚ â€¢ DistribuiÃ§Ã£o de valores                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LightGBM     â”‚ â€¢ AUC > 0.60 (classificaÃ§Ã£o)                     â”‚
â”‚              â”‚ â€¢ Direction Accuracy > 55%                       â”‚
â”‚              â”‚ â€¢ RMSE < 0.01 (regressÃ£o)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PPO          â”‚ â€¢ Mean Reward crescente                          â”‚
â”‚              â”‚ â€¢ Sharpe Ratio > 1.0                             â”‚
â”‚              â”‚ â€¢ Win Rate > 45%                                 â”‚
â”‚              â”‚ â€¢ Max Drawdown < 20%                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ API          â”‚ â€¢ LatÃªncia < 100ms                               â”‚
â”‚              â”‚ â€¢ Uptime > 99%                                   â”‚
â”‚              â”‚ â€¢ ValidaÃ§Ã£o de entrada                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ”„ Pipeline de Melhoria ContÃ­nua

```
1. Coleta de Dados (contÃ­nua)
   â””â”€> 2. Retreinamento (mensal)
       â””â”€> 3. ValidaÃ§Ã£o (walk-forward)
           â””â”€> 4. A/B Test (novo vs antigo)
               â””â”€> 5. Deploy (se melhor)
                   â””â”€> 6. Monitoramento
                       â””â”€> volta para 1
```
